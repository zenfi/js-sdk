!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ZenfiSDK=t()}(this,function(){"use strict";function t(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function a(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,n;t=r,e=o[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function u(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function c(c){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=c.apply(e,a);function o(e){u(r,t,n,o,i,"next",e)}function i(e){u(r,t,n,o,i,"throw",e)}o(void 0)})}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};for(var n,r={},o=Object.keys(e),i=0;i<o.length;i++)n=o[i],0<=t.indexOf(n)||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),i=0;i<o.length;i++)n=o[i],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}var e=function(e){return null==e},n=function(e){return e&&"[object Function]"==={}.toString.call(e)},o=["selector","value"],i="value",f="click",l="text";var p,h=function(e){var t=e.selector,n=e.value,e=r(e,o).strategy||i;return(t=document.querySelector(t))?(e===i&&(t.value=n),e===l&&(t.innerText=n),e===f&&t.click(),t):null};p=function(){function c(){for(var e=0,t={};e<arguments.length;e++){var n,r=arguments[e];for(n in r)t[n]=r[n]}return t}function s(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(u){function a(){}function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=c({path:"/"},a.defaults,n)).expires&&(n.expires=new Date(+new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var r=JSON.stringify(t);/^[\{\[]/.test(r)&&(t=r)}catch(e){}t=u.write?u.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o,i="";for(o in n)n[o]&&(i+="; "+o,!0!==n[o]&&(i+="="+n[o].split(";")[0]));return document.cookie=e+"="+t+i}}function t(e,t){if("undefined"!=typeof document){for(var n={},r=document.cookie?document.cookie.split("; "):[],o=0;o<r.length;o++){var i=r[o].split("="),a=i.slice(1).join("=");t||'"'!==a.charAt(0)||(a=a.slice(1,-1));try{var c=s(i[0]),a=(u.read||u)(a,c)||s(a);if(t)try{a=JSON.parse(a)}catch(e){}if(n[c]=a,e===c)break}catch(e){}}return e?n[e]:n}}return a.set=n,a.get=function(e){return t(e,!1)},a.getJSON=function(e){return t(e,!0)},a.remove=function(e,t){n(e,"",c(t,{expires:-1}))},a.defaults={},a.withConverter=e,a}(function(){})};var d=p();var v={url:"https://api.zenfi.mx/products/leads/info",method:"GET"},y={url:"https://api.zenfi.mx/webhooks/leads/:partner/:type",method:"POST"},m={Accept:"application/json","Content-Type":"application/json"};var g="zfid",k="zftoken";var b=e,O=n,w=h,j=function(e){function t(e,t){return d.set(e,t,{domain:n,path:"/",secure:!0,expires:365})}var n=e.domain,r="zenfi_id",o="zenfi_token";return{getId:function(){return d.get(r)},setId:function(e){return t(r,e)},getToken:function(){return d.get(o)},setToken:function(e){return t(o,e)}}},x=function(e){var t=(n=v).url,n=n.method,e="".concat(t,"?token=").concat(e);return fetch(e,{method:n,headers:m}).then(function(e){return e.json()}).then(function(e){return e.info||{}})},P=function(e){var t=e.partner,n=e.type,r=e.zenfiId,o=e.event,i=e.meta,e=(a=y).url,a=a.method,t=e.replace(":type",n).replace(":partner",t);return fetch(t,{method:a,headers:m,body:JSON.stringify({zenfiId:r,event:o,meta:i})}).then(function(e){return e.json()})},S=function(e){return{id:(e=new URLSearchParams(e.search)).get(g)||null,token:e.get(k)||null}},I=function(e){var t=new URL(e);return(e=new URLSearchParams(t.search)).delete(k),t.search=e.toString(),t.toString()};return function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.partnerName,n=e.cookiesDomain,e=e.targets;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this._id=null,this._token=null,this.leadInfo=null,this.partnerName=t,this.targets=e,this.cookies=j({domain:n}),this._handleUrlParams()}var e,t,n,o,i;return e=r,(t=[{key:"_handleUrlParams",value:function(){var e=S(location),t=e.id,e=e.token;t&&(this.id=t),e&&(this.token=e,history.replaceState(null,null,I(location.href)))}},{key:"id",get:function(){return this._id||(this._id=this.cookies.getId()),this._id},set:function(e){this._id=e||null,this.cookies.setId(this._id)}},{key:"token",get:function(){return this._token||(this._token=this.cookies.getToken()),this._token},set:function(e){this._token=e||null,this.cookies.setToken(this._token)}},{key:"fetchData",value:(i=c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.token){e.next=2;break}return e.abrupt("return",null);case 2:if(this.leadInfo){e.next=6;break}return e.next=5,x(this.token);case 5:this.leadInfo=e.sent;case 6:return e.abrupt("return",this.leadInfo);case 7:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"fillTargets",value:(o=c(regeneratorRuntime.mark(function e(){var i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchData();case 2:(this.targets||[]).forEach(function(e){var t=e||{},n=t.dataKey,r=t.strategy,o=t.afterAction,t=(i.leadInfo||{})[n];b(t)||(e={value:t,selector:O(e.selector)?e.selector({dataKey:n,strategy:r,value:t}):e.selector,strategy:r},r=w(e),O(o)&&o(a(a({},e),{},{element:r})))});case 3:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"trackEvent",value:function(e,t,n){if(!this.partnerName)throw new Error('Parameter "partnerName" is required to track events');return P({type:e,partner:this.partnerName,zenfiId:this.id,event:t,meta:n})}},{key:"trackConversion",value:function(e,t){this.trackEvent("converted",e,t)}},{key:"trackAbortion",value:function(e,t){this.trackEvent("aborted",e,t)}}])&&s(e.prototype,t),n&&s(e,n),r}()});
//# sourceMappingURL=index.js.map
