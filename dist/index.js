!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ZenfiSDK=t()}(this,function(){"use strict";function c(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function a(u){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=u.apply(e,a);function o(e){c(r,t,n,o,i,"next",e)}function i(e){c(r,t,n,o,i,"throw",e)}o(void 0)})}}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};for(var n,r={},o=Object.keys(e),i=0;i<o.length;i++)n=o[i],0<=t.indexOf(n)||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),i=0;i<o.length;i++)n=o[i],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}var o=["selector","value"],i="value",f="html";var e=function(e){var t=e.selector,n=e.value,e=r(e,o).strategy||i;return(t=document.querySelector(t))?(e===i&&(t.value=n),e===f&&(t.innerText=n),t):null};var t,n=function(e){var t="zfid",n="zftoken";return{id:(e=new URLSearchParams(e.search)).get(t)||null,token:e.get(n)||null}};t=function(){function u(){for(var e=0,t={};e<arguments.length;e++){var n,r=arguments[e];for(n in r)t[n]=r[n]}return t}function s(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(c){function a(){}function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=u({path:"/"},a.defaults,n)).expires&&(n.expires=new Date(+new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var r=JSON.stringify(t);/^[\{\[]/.test(r)&&(t=r)}catch(e){}t=c.write?c.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o,i="";for(o in n)n[o]&&(i+="; "+o,!0!==n[o]&&(i+="="+n[o].split(";")[0]));return document.cookie=e+"="+t+i}}function t(e,t){if("undefined"!=typeof document){for(var n={},r=document.cookie?document.cookie.split("; "):[],o=0;o<r.length;o++){var i=r[o].split("="),a=i.slice(1).join("=");t||'"'!==a.charAt(0)||(a=a.slice(1,-1));try{var u=s(i[0]),a=(c.read||c)(a,u)||s(a);if(t)try{a=JSON.parse(a)}catch(e){}if(n[u]=a,e===u)break}catch(e){}}return e?n[e]:n}}return a.set=n,a.get=function(e){return t(e,!1)},a.getJSON=function(e){return t(e,!0)},a.remove=function(e,t){n(e,"",u(t,{expires:-1}))},a.defaults={},a.withConverter=e,a}(function(){})};var l=t();var p={url:"https://api.zenfi.mx/products/leads/info",method:"GET"},d={url:"https://api.zenfi.mx/webhooks/leads/:partner/:type",method:"POST"},h={Accept:"application/json","Content-Type":"application/json"};var v=e,m=n,y=function(e){function t(e,t){return l.set(e,t,{domain:n,path:"/",secure:!0,expires:365})}var n=e.domain,r="zenfi_id",o="zenfi_token";return{getId:function(){return l.get(r)},setId:function(e){return t(r,e)},getToken:function(){return l.get(o)},setToken:function(e){return t(o,e)}}},k=function(e){var t=(n=p).url,n=n.method,e="".concat(t,"?token=").concat(e);return fetch(e,{method:n,headers:h}).then(function(e){return e.json()}).then(function(e){return e.info||{}})},g=function(e){var t=e.partner,n=e.type,r=e.zenfiId,o=e.event,i=e.meta,e=(a=d).url,a=a.method,t=e.replace(":type",n).replace(":partner",t);return fetch(t,{method:a,headers:h,body:JSON.stringify({zenfiId:r,event:o,meta:i})}).then(function(e){return e.json()})};return function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.partnerName,n=e.cookiesDomain,e=e.targets;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),s(this,"leadInfo",null),s(this,"token",null),s(this,"id",null),this.partnerName=t,this.targets=e,this.cookies=y({domain:n});e=m(location),n=e.id,e=e.token;n&&this.setId(n),e&&this.setToken(e)}var e,t,n,o,i;return e=r,(t=[{key:"setId",value:function(e){this.id=e||null,this.cookies.setId(this.id)}},{key:"setToken",value:function(e){this.token=e||null,this.cookies.setToken(this.token)}},{key:"fetchData",value:(i=a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.leadInfo){e.next=4;break}return e.next=3,k(this.token);case 3:this.leadInfo=e.sent;case 4:return e.abrupt("return",this.leadInfo);case 5:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"fillTargets",value:(o=a(regeneratorRuntime.mark(function e(){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchData();case 2:(this.targets||[]).forEach(function(e){var t=e.dataKey,n=e.selector,e=e.strategy,t=(r.leadInfo||{})[t];t&&v({selector:n,value:t,strategy:e})});case 3:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"trackEvent",value:function(e,t,n){if(!this.partnerName)throw new Error('Parameter "partnerName" is required to track events');return g({type:e,partner:this.partnerName,zenfiId:this.id,event:t,meta:n})}},{key:"trackConversion",value:function(e,t){this.trackEvent("converted",e,t)}},{key:"trackAbortion",value:function(e,t){this.trackEvent("aborted",e,t)}}])&&u(e.prototype,t),n&&u(e,n),r}()});
//# sourceMappingURL=index.js.map
