{"version":3,"file":"index.js","sources":["../src/dom.js","../node_modules/js-cookie/src/js.cookie.js","../src/url.js","../src/cookies.js","../src/fetcher.js","../src/index.js"],"sourcesContent":["const STRATEGIES = {\n  value: 'value',\n  html: 'html'\n}\n\nfunction fillTarget({ selector, value, ...params }) {\n  const strategy = params.strategy || STRATEGIES.value;\n  const element = document.querySelector(selector);\n\n  if (!element) return null;\n  if (strategy === STRATEGIES.value) element.value = value;\n  if (strategy === STRATEGIES.html) element.innerText = value;\n  return element;\n}\n\nmodule.exports = {\n  fillTarget,\n};\n","/*!\n * JavaScript Cookie v2.2.1\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tvar registeredInModuleLoader;\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (!registeredInModuleLoader) {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction decode (s) {\n\t\treturn s.replace(/(%[0-9A-Z]{2})+/g, decodeURIComponent);\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api() {}\n\n\t\tfunction set (key, value, attributes) {\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tattributes = extend({\n\t\t\t\tpath: '/'\n\t\t\t}, api.defaults, attributes);\n\n\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\tattributes.expires = new Date(new Date() * 1 + attributes.expires * 864e+5);\n\t\t\t}\n\n\t\t\t// We're using \"expires\" because \"max-age\" is not supported by IE\n\t\t\tattributes.expires = attributes.expires ? attributes.expires.toUTCString() : '';\n\n\t\t\ttry {\n\t\t\t\tvar result = JSON.stringify(value);\n\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\tvalue = result;\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\n\t\t\tvalue = converter.write ?\n\t\t\t\tconverter.write(value, key) :\n\t\t\t\tencodeURIComponent(String(value))\n\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\n\t\t\tkey = encodeURIComponent(String(key))\n\t\t\t\t.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent)\n\t\t\t\t.replace(/[\\(\\)]/g, escape);\n\n\t\t\tvar stringifiedAttributes = '';\n\t\t\tfor (var attributeName in attributes) {\n\t\t\t\tif (!attributes[attributeName]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tstringifiedAttributes += '; ' + attributeName;\n\t\t\t\tif (attributes[attributeName] === true) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Considers RFC 6265 section 5.2:\n\t\t\t\t// ...\n\t\t\t\t// 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n\t\t\t\t//     character:\n\t\t\t\t// Consume the characters of the unparsed-attributes up to,\n\t\t\t\t// not including, the first %x3B (\";\") character.\n\t\t\t\t// ...\n\t\t\t\tstringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n\t\t\t}\n\n\t\t\treturn (document.cookie = key + '=' + value + stringifiedAttributes);\n\t\t}\n\n\t\tfunction get (key, json) {\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar jar = {};\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all.\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (!json && cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar name = decode(parts[0]);\n\t\t\t\t\tcookie = (converter.read || converter)(cookie, name) ||\n\t\t\t\t\t\tdecode(cookie);\n\n\t\t\t\t\tif (json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tjar[name] = cookie;\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn key ? jar[key] : jar;\n\t\t}\n\n\t\tapi.set = set;\n\t\tapi.get = function (key) {\n\t\t\treturn get(key, false /* read as raw */);\n\t\t};\n\t\tapi.getJSON = function (key) {\n\t\t\treturn get(key, true /* read as json */);\n\t\t};\n\t\tapi.remove = function (key, attributes) {\n\t\t\tset(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.defaults = {};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n","function getUrlParams(location) {\n  const URL_PARAMS = {\n    id: 'zfid',\n    token: 'zftoken'\n  };\n  const searchParams = new URLSearchParams(location.search);\n\n  return {\n    id: searchParams.get(URL_PARAMS.id) || null,\n    token: searchParams.get(URL_PARAMS.token) || null\n  };\n}\n\nmodule.exports = {\n  getUrlParams\n};\n","const Cookies = require('js-cookie');\n\nfunction buildCookies({ domain }) {\n  const ONE_YEAR = 365;\n  const COOKIE_NAMES = {\n    id: 'zenfi_id',\n    token: 'zenfi_token'\n  };\n\n  const setCookie = (name, value) => Cookies.set(name, value, {\n    domain,\n    path: '/',\n    secure: true,\n    expires: ONE_YEAR\n  });\n\n  const getId = () => Cookies.get(COOKIE_NAMES.id);\n\n  const setId = (value) => setCookie(COOKIE_NAMES.id, value);\n\n  const getToken = () => Cookies.get(COOKIE_NAMES.token);\n\n  const setToken = (value) => setCookie(COOKIE_NAMES.token, value);\n\n  return {\n    getId,\n    setId,\n    getToken,\n    setToken\n  };\n}\n\nmodule.exports = {\n  buildCookies\n};\n","const ENDPOINTS = {\n  leadsInfo: {\n    url: 'https://api.zenfi.mx/products/leads/info',\n    method: 'GET'\n  },\n  trackEvent: {\n    url: 'https://api.zenfi.mx/webhooks/leads/:partner/:type',\n    method: 'POST'\n  }\n};\n\nconst DEFAULT_HEADERS = {\n  'Accept': 'application/json',\n  'Content-Type': 'application/json'\n};\n\nfunction fetchLeadInfo(token) {\n  const { url: baseUrl, method } = ENDPOINTS.leadsInfo;\n  const url = `${baseUrl}?token=${token}`;\n\n  return fetch(url, {\n    method,\n    headers: DEFAULT_HEADERS\n  })\n    .then(response => response.json())\n    .then(data => data.info || {});\n}\n\nfunction trackEvent({ partner, type, zenfiId, event, meta }) {\n  const { url: baseUrl, method } = ENDPOINTS.trackEvent;\n  const url = baseUrl\n    .replace(':type', type)\n    .replace(':partner', partner);\n\n  const body = {\n    zenfiId,\n    event,\n    meta\n  };\n\n  return fetch(url, {\n    method,\n    headers: DEFAULT_HEADERS,\n    body: JSON.stringify(body)\n  })\n    .then(response => response.json());\n}\n\nmodule.exports = {\n  fetchLeadInfo,\n  trackEvent\n};\n","const { fillTarget } = require('./dom');\nconst { getUrlParams } = require('./url');\nconst { buildCookies } = require('./cookies');\nconst { fetchLeadInfo, trackEvent } = require('./fetcher');\n\nclass ZenfiSDK {\n  leadInfo = null;\n  token = null;\n  id = null;\n\n  constructor({ partnerName, cookiesDomain, targets } = {}) {\n    this.partnerName = partnerName;\n    this.targets = targets;\n    this.cookies = buildCookies({ domain: cookiesDomain });\n\n    const { id, token } = getUrlParams(location);\n    if (id) this.setId(id);\n    if (token) this.setToken(token);\n  }\n\n  setId(id) {\n    this.id = id || null;\n    this.cookies.setId(this.id);\n  }\n\n  setToken(token) {\n    this.token = token || null;\n    this.cookies.setToken(this.token);\n  }\n\n  async fetchData() {\n    if (!this.leadInfo) this.leadInfo = await fetchLeadInfo(this.token);\n    return this.leadInfo;\n  }\n\n  async fillTargets() {\n    await this.fetchData();\n    (this.targets || []).forEach(({ dataKey, selector, strategy }) => {\n      const value = (this.leadInfo || {})[dataKey];\n      if (value) fillTarget({ selector, value, strategy });\n    });\n  }\n\n  trackEvent(type, name, properties) {\n    if (!this.partnerName) throw new Error('Parameter \"partnerName\" is required to track events');\n    return trackEvent({\n      type,\n      partner: this.partnerName,\n      zenfiId: this.id,\n      event: name,\n      meta: properties,\n    });\n  }\n\n  trackConversion(name, properties) {\n    this.trackEvent('converted', name, properties);\n  }\n\n  trackAbortion(name, properties) {\n    this.trackEvent('aborted', name, properties);\n  }\n}\n\nmodule.exports = ZenfiSDK;\n"],"names":["STRATEGIES","dom","selector","value","strategy","element","document","querySelector","innerText","factory","url","location","URL_PARAMS","id","searchParams","URLSearchParams","search","get","token","extend","i","result","arguments","length","key","attributes","decode","s","replace","decodeURIComponent","init","converter","api","set","path","defaults","expires","Date","toUTCString","JSON","stringify","test","e","write","encodeURIComponent","String","escape","attributeName","stringifiedAttributes","split","cookie","json","jar","cookies","parts","slice","join","charAt","name","read","parse","getJSON","remove","withConverter","Cookies","ENDPOINTS","method","DEFAULT_HEADERS","fillTarget","require$$0","getUrlParams","require$$1","buildCookies","setCookie","domain","secure","COOKIE_NAMES","getId","setId","getToken","setToken","fetchLeadInfo","baseUrl","fetch","headers","then","response","data","info","trackEvent","partner","type","zenfiId","event","meta","body","partnerName","cookiesDomain","targets","this","leadInfo","fetchData","forEach","dataKey","_this","properties","Error"],"mappings":"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"}